

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. Advanced multilevel models &mdash; hmp 1.0.0-b.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=12f248e0"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/tabs.js?v=3ee01567"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Performing model selection" href="5-advanced--model_selection.html" />
    <link rel="prev" title="3. Applying HMP to real data" href="3-Applying_HMP_to_real_data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/hmp.html">hmp package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-How_HMP_works.html">1 How HMP works: practical, methodological and theoretical grounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-The_different_model_classes.html">2. The different model classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-Applying_HMP_to_real_data.html">3. Applying HMP to real data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Advanced multilevel models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Fit-/-transform">Fit / transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Multilevel-models">Multilevel models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="5-advanced--model_selection.html">5. Performing model selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data_loading.html">Reading your own data</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hmp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">4. Advanced multilevel models</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/4-advanced-multilevel_models.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="4.-Advanced-multilevel-models">
<h1>4. Advanced multilevel models<a class="headerlink" href="#4.-Advanced-multilevel-models" title="Link to this heading"></a></h1>
<blockquote>
<div><p>[!WARNING] This tutorial and the associated functions are still under construction, only use these functions for development puprose</p>
</div></blockquote>
<p>For this tutorial we will simulate data for two participants, one with noise and one without. We make the simulation deterministic by providing the exact times at which we want the events to occur for two trials. Importantly we will use the same source names and parameters for both participants, but we will swap the first two sources between the two participants. This will allow us to test the multilevel model’s ability to handle different event configuration across conditions or participants.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">op</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hmp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hmp</span><span class="w"> </span><span class="kn">import</span> <span class="n">simulations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">sfreq</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_events</span> <span class="o">=</span> <span class="mi">3</span>
<span class="c1"># Data creation/reading</span>
<span class="c1">## Simulation parameters</span>
<span class="n">n_trials</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># Times (in milliseconds) for participant A: 3 events per trial, 2 trials with the following time structure:</span>
<span class="c1"># On trial 1 the events will occur at 100ms, 300ms, and 400ms after the simulated trial onset</span>
<span class="c1"># On trial 2 all inter-event duration were doubled and thus occur at 200ms, 600ms, and 800ms after the simulated trial onset</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="c1"># Thus, on average, the events appear at 150, 450 and 600ms after trial onset</span>
<span class="n">avg_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">times</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Define source names and parameters, the same for both participants</span>
<span class="n">names_a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bankssts-rh&#39;</span><span class="p">,</span> <span class="s1">&#39;bankssts-lh&#39;</span><span class="p">,</span> <span class="s1">&#39;caudalanteriorcingulate-rh&#39;</span><span class="p">,</span> <span class="s1">&#39;bankssts-lh&#39;</span><span class="p">]</span>
<span class="c1"># same but the two first sources are swapped</span>
<span class="n">names_b</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bankssts-lh&#39;</span><span class="p">,</span> <span class="s1">&#39;bankssts-rh&#39;</span><span class="p">,</span><span class="s1">&#39;caudalanteriorcingulate-rh&#39;</span><span class="p">,</span> <span class="s1">&#39;bankssts-lh&#39;</span><span class="p">]</span>
<span class="n">sources_a</span><span class="p">,</span> <span class="n">sources_b</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name_a_i</span><span class="p">,</span> <span class="n">name_b_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names_a</span><span class="p">,</span> <span class="n">names_b</span><span class="p">):</span>
    <span class="n">sources_a</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name_a_i</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">4e-8</span><span class="p">])</span>
    <span class="n">sources_b</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name_b_i</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">4e-8</span><span class="p">])</span>

<span class="c1">## Now we simulated two datasets with the exact same structure except one is noise, one isn&#39;t</span>
<span class="c1"># Participant A is noisy</span>
<span class="n">files_a</span> <span class="o">=</span> <span class="n">simulations</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">sources_a</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;dataset_a_raw&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sfreq</span><span class="o">=</span><span class="n">sfreq</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sample_data&#39;</span><span class="p">,</span> <span class="s1">&#39;simulated&#39;</span><span class="p">))</span>
<span class="c1"># Participant B has no noise</span>
<span class="n">files_b</span> <span class="o">=</span> <span class="n">simulations</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">sources_b</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;dataset_b_raw&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sfreq</span><span class="o">=</span><span class="n">sfreq</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;sample_data&#39;</span><span class="p">,</span> <span class="s1">&#39;simulated&#39;</span><span class="p">))</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulating /home/gabriel/ownCloud/projects/RUGUU/hmp/docs/source/notebooks/sample_data/simulated/dataset_a_raw_raw.fif
/home/gabriel/ownCloud/projects/RUGUU/hmp/docs/source/notebooks/sample_data/simulated/dataset_a_raw_raw.fif simulated
Simulating /home/gabriel/ownCloud/projects/RUGUU/hmp/docs/source/notebooks/sample_data/simulated/dataset_b_raw_raw.fif
/home/gabriel/ownCloud/projects/RUGUU/hmp/docs/source/notebooks/sample_data/simulated/dataset_b_raw_raw.fif simulated
</pre></div></div>
</div>
<p>Next we read the data as we do for simulations (Tutorial 1)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">event_id</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stimulus&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span><span class="c1">#trigger 1 = stimulus</span>
<span class="n">resp_id</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;response&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
<span class="n">raws</span><span class="p">,</span> <span class="n">events</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">files</span> <span class="ow">in</span> <span class="p">[</span><span class="n">files_a</span><span class="p">,</span> <span class="n">files_b</span><span class="p">]:</span>
    <span class="n">raws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">event_a</span><span class="p">,</span> <span class="n">event_b</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Data reading</span>
<span class="n">epoch_data</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_mne_data</span><span class="p">(</span><span class="n">raws</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="n">event_id</span><span class="p">,</span> <span class="n">resp_id</span><span class="o">=</span><span class="n">resp_id</span><span class="p">,</span> <span class="n">sfreq</span><span class="o">=</span><span class="n">sfreq</span><span class="p">,</span>
        <span class="n">events_provided</span><span class="o">=</span><span class="n">events</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subj_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">simulations</span><span class="o">.</span><span class="n">positions</span><span class="p">()</span>
<span class="n">epoch_data</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Processing participant /home/gabriel/ownCloud/projects/RUGUU/hmp/docs/source/notebooks/sample_data/simulated/dataset_a_raw_raw.fif&#39;s raw eeg
2 trials were retained for participant /home/gabriel/ownCloud/projects/RUGUU/hmp/docs/source/notebooks/sample_data/simulated/dataset_a_raw_raw.fif
Processing participant /home/gabriel/ownCloud/projects/RUGUU/hmp/docs/source/notebooks/sample_data/simulated/dataset_b_raw_raw.fif&#39;s raw eeg
2 trials were retained for participant /home/gabriel/ownCloud/projects/RUGUU/hmp/docs/source/notebooks/sample_data/simulated/dataset_b_raw_raw.fif
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1f1f1f;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "►";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "▼";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 191kB
Dimensions:      (participant: 2, epoch: 2, channel: 59, sample: 100)
Coordinates:
  * epoch        (epoch) int64 16B 0 1
  * channel      (channel) &lt;U7 2kB &#x27;EEG 001&#x27; &#x27;EEG 002&#x27; ... &#x27;EEG 059&#x27; &#x27;EEG 060&#x27;
  * sample       (sample) int64 800B 0 1 2 3 4 5 6 7 ... 92 93 94 95 96 97 98 99
    event_name   (epoch) object 16B &#x27;stimulus&#x27; &#x27;stimulus&#x27;
    rt           (epoch) float64 16B 0.5 1.0
  * participant  (participant) &lt;U1 8B &#x27;a&#x27; &#x27;b&#x27;
Data variables:
    data         (participant, epoch, channel, sample) float64 189kB -1.096e-...
Attributes:
    sfreq:             100.0
    offset:            0
    lowpass:           40.0
    highpass:          0.10000000149011612
    lower_limit_rt:    0
    upper_limit_rt:    inf
    reject_threshold:  None
    n_trials:          4</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-00cdae98-ca1a-4d57-896c-0a4ee7a095bf' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-00cdae98-ca1a-4d57-896c-0a4ee7a095bf' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>participant</span>: 2</li><li><span class='xr-has-index'>epoch</span>: 2</li><li><span class='xr-has-index'>channel</span>: 59</li><li><span class='xr-has-index'>sample</span>: 100</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-c1e43736-c16c-41d0-ab69-9ab281418e0e' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c1e43736-c16c-41d0-ab69-9ab281418e0e' class='xr-section-summary' >Coordinates: <span>(6)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>epoch</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1</div><input id='attrs-b6db0559-fc9e-4492-80cc-995a4becf58a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b6db0559-fc9e-4492-80cc-995a4becf58a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-85d0f476-2db3-4d5d-8cf0-9d1e36957f3d' class='xr-var-data-in' type='checkbox'><label for='data-85d0f476-2db3-4d5d-8cf0-9d1e36957f3d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0, 1])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>channel</span></div><div class='xr-var-dims'>(channel)</div><div class='xr-var-dtype'>&lt;U7</div><div class='xr-var-preview xr-preview'>&#x27;EEG 001&#x27; &#x27;EEG 002&#x27; ... &#x27;EEG 060&#x27;</div><input id='attrs-69f0ef62-23c0-4c84-baa7-13f454851807' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-69f0ef62-23c0-4c84-baa7-13f454851807' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a6a723d9-b631-48ed-b4a2-dd9301118549' class='xr-var-data-in' type='checkbox'><label for='data-a6a723d9-b631-48ed-b4a2-dd9301118549' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
       &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
       &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
       &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
       &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
       &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
       &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
       &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
       &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;,
       &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;], dtype=&#x27;&lt;U7&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>sample</span></div><div class='xr-var-dims'>(sample)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 6 ... 94 95 96 97 98 99</div><input id='attrs-af190771-bddf-4a88-a05e-a18e7051b05e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-af190771-bddf-4a88-a05e-a18e7051b05e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-69760c73-c669-4051-a6ff-1dd57b234a5d' class='xr-var-data-in' type='checkbox'><label for='data-69760c73-c669-4051-a6ff-1dd57b234a5d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
       18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
       36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53,
       54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71,
       72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
       90, 91, 92, 93, 94, 95, 96, 97, 98, 99])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>event_name</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;stimulus&#x27; &#x27;stimulus&#x27;</div><input id='attrs-c7066663-8720-46a9-9849-6a1c49d80600' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c7066663-8720-46a9-9849-6a1c49d80600' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-230f1203-518a-4727-a10b-1be1aa14987a' class='xr-var-data-in' type='checkbox'><label for='data-230f1203-518a-4727-a10b-1be1aa14987a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;stimulus&#x27;, &#x27;stimulus&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>rt</span></div><div class='xr-var-dims'>(epoch)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5 1.0</div><input id='attrs-433b1514-718b-48a5-bac9-f00f4c2da187' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-433b1514-718b-48a5-bac9-f00f4c2da187' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-362a0fa1-7bda-41b2-8534-9c6bcb1cbd1e' class='xr-var-data-in' type='checkbox'><label for='data-362a0fa1-7bda-41b2-8534-9c6bcb1cbd1e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.5, 1. ])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>participant</span></div><div class='xr-var-dims'>(participant)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;a&#x27; &#x27;b&#x27;</div><input id='attrs-cb0cdab9-f447-4dca-90cc-27e953ab7a8f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cb0cdab9-f447-4dca-90cc-27e953ab7a8f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a1818b3b-2d16-4424-8ffd-258f205918ce' class='xr-var-data-in' type='checkbox'><label for='data-a1818b3b-2d16-4424-8ffd-258f205918ce' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;a&#x27;, &#x27;b&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-1f909994-91f4-4ac8-afd0-0f9722bd4ab4' class='xr-section-summary-in' type='checkbox'  checked><label for='section-1f909994-91f4-4ac8-afd0-0f9722bd4ab4' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>data</span></div><div class='xr-var-dims'>(participant, epoch, channel, sample)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-1.096e-07 ... -1.382e-19</div><input id='attrs-80577688-333e-4756-b054-0c9dd9dbc172' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-80577688-333e-4756-b054-0c9dd9dbc172' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7dd4afff-ff7a-4f58-a1b8-6482b598f102' class='xr-var-data-in' type='checkbox'><label for='data-7dd4afff-ff7a-4f58-a1b8-6482b598f102' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[-1.09630534e-07, -1.43795659e-06, -1.59821467e-06, ...,
                      nan,             nan,             nan],
         [-2.50770831e-06, -4.90660156e-06, -3.85702712e-06, ...,
                      nan,             nan,             nan],
         [-4.01725230e-07, -1.65754311e-06, -1.68842783e-06, ...,
                      nan,             nan,             nan],
         ...,
         [-3.05266327e-07, -2.70974689e-06, -2.25687430e-06, ...,
                      nan,             nan,             nan],
         [ 1.15372376e-06,  1.61905686e-06,  3.08422956e-06, ...,
                      nan,             nan,             nan],
         [ 1.27618549e-06, -2.08939706e-07, -9.25170163e-07, ...,
                      nan,             nan,             nan]],

        [[ 5.74623137e-07,  1.94484374e-06,  8.04283863e-07, ...,
           7.48170450e-08, -8.86829353e-07, -1.56936309e-06],
         [ 4.59807156e-09, -5.55049967e-07, -1.46007026e-06, ...,
           2.32979248e-06,  4.08560965e-06,  4.11365975e-06],
         [ 8.65679572e-07, -6.54565457e-07, -1.56480169e-06, ...,
           3.61823587e-06,  1.58996290e-06,  2.11469927e-06],
...
                      nan,             nan,             nan],
         [-4.67883108e-19,  2.33941554e-20,  2.33941554e-20, ...,
                      nan,             nan,             nan],
         [-6.20329757e-19,  3.10164879e-20,  3.10164879e-20, ...,
                      nan,             nan,             nan]],

        [[ 9.04442383e-20, -4.52221192e-21, -4.52221192e-21, ...,
          -4.52221192e-21,  1.77867835e-19,  4.72981135e-19],
         [ 3.86667084e-20, -1.93333542e-21, -1.93333542e-21, ...,
          -1.93333542e-21,  1.55376477e-19,  4.09909103e-19],
         [-2.74975103e-20,  1.37487551e-21,  1.37487551e-21, ...,
           1.37487551e-21,  1.33774886e-19,  3.48002600e-19],
         ...,
         [-4.97421044e-19,  2.48710522e-20,  2.48710522e-20, ...,
           2.48710522e-20, -1.38243707e-19, -4.02168935e-19],
         [-4.67883108e-19,  2.33941554e-20,  2.33941554e-20, ...,
           2.33941554e-20, -1.05287724e-19, -3.13499357e-19],
         [-6.20329757e-19,  3.10164879e-20,  3.10164879e-20, ...,
           3.10164879e-20, -3.36301983e-20, -1.38230735e-19]]]],
      shape=(2, 2, 59, 100))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-4819003d-5ccc-425f-a109-3cb3c4055810' class='xr-section-summary-in' type='checkbox'  ><label for='section-4819003d-5ccc-425f-a109-3cb3c4055810' class='xr-section-summary' >Indexes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>epoch</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-6eb44fd0-090b-498f-a768-4b39f4d0b29b' class='xr-index-data-in' type='checkbox'/><label for='index-6eb44fd0-090b-498f-a768-4b39f4d0b29b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([0, 1], dtype=&#x27;int64&#x27;, name=&#x27;epoch&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>channel</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-c17d82a1-1483-47d0-850a-606860b56be5' class='xr-index-data-in' type='checkbox'/><label for='index-c17d82a1-1483-47d0-850a-606860b56be5' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;EEG 001&#x27;, &#x27;EEG 002&#x27;, &#x27;EEG 003&#x27;, &#x27;EEG 004&#x27;, &#x27;EEG 005&#x27;, &#x27;EEG 006&#x27;,
       &#x27;EEG 007&#x27;, &#x27;EEG 008&#x27;, &#x27;EEG 009&#x27;, &#x27;EEG 010&#x27;, &#x27;EEG 011&#x27;, &#x27;EEG 012&#x27;,
       &#x27;EEG 013&#x27;, &#x27;EEG 014&#x27;, &#x27;EEG 015&#x27;, &#x27;EEG 016&#x27;, &#x27;EEG 017&#x27;, &#x27;EEG 018&#x27;,
       &#x27;EEG 019&#x27;, &#x27;EEG 020&#x27;, &#x27;EEG 021&#x27;, &#x27;EEG 022&#x27;, &#x27;EEG 023&#x27;, &#x27;EEG 024&#x27;,
       &#x27;EEG 025&#x27;, &#x27;EEG 026&#x27;, &#x27;EEG 027&#x27;, &#x27;EEG 028&#x27;, &#x27;EEG 029&#x27;, &#x27;EEG 030&#x27;,
       &#x27;EEG 031&#x27;, &#x27;EEG 032&#x27;, &#x27;EEG 033&#x27;, &#x27;EEG 034&#x27;, &#x27;EEG 035&#x27;, &#x27;EEG 036&#x27;,
       &#x27;EEG 037&#x27;, &#x27;EEG 038&#x27;, &#x27;EEG 039&#x27;, &#x27;EEG 040&#x27;, &#x27;EEG 041&#x27;, &#x27;EEG 042&#x27;,
       &#x27;EEG 043&#x27;, &#x27;EEG 044&#x27;, &#x27;EEG 045&#x27;, &#x27;EEG 046&#x27;, &#x27;EEG 047&#x27;, &#x27;EEG 048&#x27;,
       &#x27;EEG 049&#x27;, &#x27;EEG 050&#x27;, &#x27;EEG 051&#x27;, &#x27;EEG 052&#x27;, &#x27;EEG 054&#x27;, &#x27;EEG 055&#x27;,
       &#x27;EEG 056&#x27;, &#x27;EEG 057&#x27;, &#x27;EEG 058&#x27;, &#x27;EEG 059&#x27;, &#x27;EEG 060&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;channel&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>sample</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-fe9c1167-2ed4-4dcf-a32e-eb79d535c60b' class='xr-index-data-in' type='checkbox'/><label for='index-fe9c1167-2ed4-4dcf-a32e-eb79d535c60b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
       18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
       36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53,
       54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71,
       72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
       90, 91, 92, 93, 94, 95, 96, 97, 98, 99],
      dtype=&#x27;int64&#x27;, name=&#x27;sample&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>participant</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-44d0d10d-07e3-4664-bc5d-9f7729929b6d' class='xr-index-data-in' type='checkbox'/><label for='index-44d0d10d-07e3-4664-bc5d-9f7729929b6d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;a&#x27;, &#x27;b&#x27;], dtype=&#x27;object&#x27;, name=&#x27;participant&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b525ec19-33a8-4f44-9d89-2d773d15f7f2' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b525ec19-33a8-4f44-9d89-2d773d15f7f2' class='xr-section-summary' >Attributes: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>sfreq :</span></dt><dd>100.0</dd><dt><span>offset :</span></dt><dd>0</dd><dt><span>lowpass :</span></dt><dd>40.0</dd><dt><span>highpass :</span></dt><dd>0.10000000149011612</dd><dt><span>lower_limit_rt :</span></dt><dd>0</dd><dt><span>upper_limit_rt :</span></dt><dd>inf</dd><dt><span>reject_threshold :</span></dt><dd>None</dd><dt><span>n_trials :</span></dt><dd>4</dd></dl></div></li></ul></div></div></div>
</div>
<p>Next we preprocess the data and split conditions (or participants in this case). We will use the <code class="docutils literal notranslate"><span class="pre">hmp.preprocessing.Standard</span></code> class to handle the data preprocessing. We will also create a template for the event properties that we expect in our data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preprocess the data for both participants using the Preprocessing class</span>
<span class="n">hmp_data</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">Preprocessing</span><span class="p">(</span><span class="n">epoch_data</span><span class="p">,</span> <span class="n">n_comp</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Create event property template</span>
<span class="n">event_properties</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">patterns</span><span class="o">.</span><span class="n">HalfSine</span><span class="o">.</span><span class="n">create_expected</span><span class="p">(</span><span class="n">sfreq</span><span class="o">=</span><span class="n">epoch_data</span><span class="o">.</span><span class="n">sfreq</span><span class="p">)</span>

<span class="c1"># Select data for each participant</span>
<span class="n">hmp_data_a</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">participant_selection</span><span class="p">(</span><span class="n">hmp_data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">hmp_data_b</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">participant_selection</span><span class="p">(</span><span class="n">hmp_data</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># Create TrialData objects for all data and for each participant</span>
<span class="n">trial_data</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">trialdata</span><span class="o">.</span><span class="n">TrialData</span><span class="o">.</span><span class="n">from_preprocessed</span><span class="p">(</span><span class="n">preprocessed</span><span class="o">=</span><span class="n">hmp_data</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">event_properties</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
<span class="n">trial_data_a</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">trialdata</span><span class="o">.</span><span class="n">TrialData</span><span class="o">.</span><span class="n">from_preprocessed</span><span class="p">(</span><span class="n">preprocessed</span><span class="o">=</span><span class="n">hmp_data_a</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">event_properties</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
<span class="n">trial_data_b</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">trialdata</span><span class="o">.</span><span class="n">TrialData</span><span class="o">.</span><span class="n">from_preprocessed</span><span class="p">(</span><span class="n">preprocessed</span><span class="o">=</span><span class="n">hmp_data_b</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">event_properties</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/gabriel/ownCloud/projects/RUGUU/hmp/hmp/preprocessing.py:196: UserWarning: Data will be modified inplace, re-read the data or use copy=True if multiplecalls to this function
  warn(
</pre></div></div>
</div>
<p>Here we illustrate the ground truth estimates for the events in the noisy data. We will use these to compare the estimates obtained from the different model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">EventModel</span><span class="p">(</span><span class="n">event_properties</span><span class="p">,</span> <span class="n">n_events</span><span class="o">=</span><span class="n">n_events</span><span class="p">)</span>
<span class="c1"># Recover generating parameters</span>
<span class="n">sim_source_times</span><span class="p">,</span> <span class="n">true_time_pars</span><span class="p">,</span> <span class="n">true_channel_pars</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
    <span class="n">simulations</span><span class="o">.</span><span class="n">simulated_times_and_parameters</span><span class="p">(</span><span class="n">event_a</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">trial_data_a</span><span class="p">)</span>
<span class="c1"># Fixing true parameter in model</span>
<span class="n">model</span><span class="o">.</span><span class="n">time_pars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">true_time_pars</span><span class="p">])</span>
<span class="n">model</span><span class="o">.</span><span class="n">channel_pars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">true_channel_pars</span><span class="p">])</span>
<span class="c1"># Ground truth</span>
<span class="n">true_loglikelihood</span><span class="p">,</span> <span class="n">true_estimates</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">trial_data_a</span><span class="p">)</span>
<span class="n">hmp</span><span class="o">.</span><span class="n">visu</span><span class="o">.</span><span class="n">plot_topo_timecourse</span><span class="p">(</span><span class="n">epoch_data</span><span class="p">,</span> <span class="n">true_estimates</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">as_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">avg_times</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.LineCollection at 0x7168ee0a2570&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_4-advanced-multilevel_models_8_1.png" src="../_images/notebooks_4-advanced-multilevel_models_8_1.png" />
</div>
</div>
<p>As can be seen the true model estimates the events at the correct time but the topographies are mainly dominated by noise because we only have two trials and the sources have a very low amplitude, thus the SNR is close to zero. Fitting the model on B however gives us the a perfect representation as it is noiseless. Based on this we can see that the last event of the noiseless B estimation is the cleaner version of the last event in A. With a bit of abstraction we can also see that the two first
events between A and B are indeed reversed as we requested in the simulation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">EventModel</span><span class="p">(</span><span class="n">event_properties</span><span class="p">,</span> <span class="n">n_events</span><span class="o">=</span><span class="n">n_events</span><span class="p">)</span>

<span class="c1"># Fit and transform on noiseless B</span>
<span class="n">lkh_b</span><span class="p">,</span> <span class="n">estimates_b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">trial_data_b</span><span class="p">)</span>
<span class="n">hmp</span><span class="o">.</span><span class="n">visu</span><span class="o">.</span><span class="n">plot_topo_timecourse</span><span class="p">(</span><span class="n">epoch_data</span><span class="p">,</span> <span class="n">estimates_b</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">as_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">avg_times</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimating 3 events model with 1 starting point(s)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.LineCollection at 0x7168edf80e00&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_4-advanced-multilevel_models_10_2.png" src="../_images/notebooks_4-advanced-multilevel_models_10_2.png" />
</div>
</div>
<p>If we first try to fit the model on A the estimates will be dominated by noise. This is because the model is not able to estimate the parameters correctly from the noisy data alone.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">EventModel</span><span class="p">(</span><span class="n">event_properties</span><span class="p">,</span> <span class="n">n_events</span><span class="o">=</span><span class="n">n_events</span><span class="p">)</span>

<span class="c1"># Fit and transform on noisy A</span>
<span class="n">lkh_a</span><span class="p">,</span> <span class="n">estimates_a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">trial_data_a</span><span class="p">)</span>
<span class="n">hmp</span><span class="o">.</span><span class="n">visu</span><span class="o">.</span><span class="n">plot_topo_timecourse</span><span class="p">(</span><span class="n">epoch_data</span><span class="p">,</span> <span class="n">estimates_a</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">as_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">avg_times</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimating 3 events model with 1 starting point(s)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.LineCollection at 0x7168ee06a9f0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_4-advanced-multilevel_models_12_2.png" src="../_images/notebooks_4-advanced-multilevel_models_12_2.png" />
</div>
</div>
<section id="Fit-/-transform">
<h2>Fit / transform<a class="headerlink" href="#Fit-/-transform" title="Link to this heading"></a></h2>
<p>A first way to split conditions and use the information from one condition to estimate the other is to use the <code class="docutils literal notranslate"><span class="pre">fit/transform</span></code> architecture. In this example we can then fit the model to the data of B (noiseless) and transform the data of A using the parameters estimated on B:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">hmp</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">EventModel</span><span class="p">(</span><span class="n">event_properties</span><span class="p">,</span> <span class="n">n_events</span><span class="o">=</span><span class="n">n_events</span><span class="p">)</span>

<span class="c1"># Fit on noiseless B</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trial_data_b</span><span class="p">)</span>
<span class="c1"># Transform on noisy A</span>
<span class="n">lkh_a_transform</span><span class="p">,</span> <span class="n">estimates_a_transform</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">trial_data_a</span><span class="p">)</span>
<span class="n">hmp</span><span class="o">.</span><span class="n">visu</span><span class="o">.</span><span class="n">plot_topo_timecourse</span><span class="p">(</span><span class="n">epoch_data</span><span class="p">,</span> <span class="n">estimates_a_transform</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">as_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">avg_times</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimating 3 events model with 1 starting point(s)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.LineCollection at 0x7168edc49520&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_4-advanced-multilevel_models_15_2.png" src="../_images/notebooks_4-advanced-multilevel_models_15_2.png" />
</div>
</div>
<p>In this case this turns out pretty bad because we estimate the two first events based on B while they are reversed in A. Thus the estimation of the <code class="docutils literal notranslate"><span class="pre">channel_pars</span></code> parameters does not help to correclty estimate the model in A, to the contrary doing so will actually make the estimates worse than if we had not used the parameters from B at all.</p>
</section>
<section id="Multilevel-models">
<h2>Multilevel models<a class="headerlink" href="#Multilevel-models" title="Link to this heading"></a></h2>
<p>HMP implements multilevel models, models that share time and channel parameters across levels (e.g. condition or participant) based on a map. This map is a 2D array where each row corresponds to a level and each column corresponds to an expected event (Note we need to know how many events are present to write the map, thus this only works on the<code class="docutils literal notranslate"><span class="pre">EventModel</span></code> class).</p>
<p>The values in the map indicate which sources are shared across participants. As a wrong example we could estimate a multilevel where all the parameters for each event are shared across the two levels A and B.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># testing multilevel model with all parameters shared across participants</span>
<span class="n">channel_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>    <span class="c1"># All events share the same channel parameters</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">time_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>    <span class="c1"># All events share the same time parameters</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">level_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;participant&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]}</span>  <span class="c1"># Define participant levels</span>

<span class="c1"># Fit the multilevel model with shared parameters and get estimates</span>
<span class="n">lkh_comb</span><span class="p">,</span> <span class="n">estimates_comb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
    <span class="n">trial_data</span><span class="p">,</span>
    <span class="n">time_map</span><span class="o">=</span><span class="n">time_map</span><span class="p">,</span>
    <span class="n">channel_map</span><span class="o">=</span><span class="n">channel_map</span><span class="p">,</span>
    <span class="n">level_dict</span><span class="o">=</span><span class="n">level_dict</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Level &#34;participant&#34; analyzed, with levels: [&#39;a&#39;, &#39;b&#39;]

Coded as follows:
0: participant
1: participant

Channel map:
0:  [0 0 0]
1:  [0 0 0]

Time map:
0:  [0 0 0 0]
1:  [0 0 0 0]
Estimating 3 events model with 1 starting point(s)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hmp</span><span class="o">.</span><span class="n">visu</span><span class="o">.</span><span class="n">plot_topo_timecourse</span><span class="p">(</span><span class="n">epoch_data</span><span class="p">,</span> <span class="n">estimates_comb</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">as_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">magnify</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">avg_times</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.LineCollection at 0x7168edc63770&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_4-advanced-multilevel_models_20_1.png" src="../_images/notebooks_4-advanced-multilevel_models_20_1.png" />
</div>
</div>
<p>In this case, we expect that the parameters are all shared, thus, the first event in A is moved to the second event of B as the first event in B is the second event in A.</p>
<p>Instead we can inform the model that we expect different topographies for the first two events</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># testing multilevel model with all parameters shared across participants</span>
<span class="n">channel_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>   <span class="c1"># The two first events are not shared and will be estimated separatebly for both B and A</span>
                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">time_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>    <span class="c1"># All events still share the same time parameters</span>
                     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">level_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;participant&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]}</span>  <span class="c1"># Define participant levels</span>

<span class="c1"># Fit the multilevel model with shared parameters and get estimates</span>
<span class="n">lkh_comb</span><span class="p">,</span> <span class="n">estimates_comb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
    <span class="n">trial_data</span><span class="p">,</span>
    <span class="n">time_map</span><span class="o">=</span><span class="n">time_map</span><span class="p">,</span>
    <span class="n">channel_map</span><span class="o">=</span><span class="n">channel_map</span><span class="p">,</span>
    <span class="n">level_dict</span><span class="o">=</span><span class="n">level_dict</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Level &#34;participant&#34; analyzed, with levels: [&#39;a&#39;, &#39;b&#39;]

Coded as follows:
0: participant
1: participant

Channel map:
0:  [0 0 0]
1:  [1 1 0]

Time map:
0:  [0 0 0 0]
1:  [0 0 0 0]
Estimating 3 events model with 1 starting point(s)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hmp</span><span class="o">.</span><span class="n">visu</span><span class="o">.</span><span class="n">plot_topo_timecourse</span><span class="p">(</span><span class="n">epoch_data</span><span class="p">,</span> <span class="n">estimates_comb</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">as_time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">magnify</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">avg_times</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.LineCollection at 0x7168ed5bc200&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_4-advanced-multilevel_models_24_1.png" src="../_images/notebooks_4-advanced-multilevel_models_24_1.png" />
</div>
</div>
<p>In this case we do indeed recover the correct events, quite close to the ground truth. The first two events are estimated separately for A and B, while the third event is shared across both participants which does help the model to get the correct amplitude and time for the third event.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="3-Applying_HMP_to_real_data.html" class="btn btn-neutral float-left" title="3. Applying HMP to real data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="5-advanced--model_selection.html" class="btn btn-neutral float-right" title="5. Performing model selection" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Gabriel Weindel, Maarten Schermer, Raoul Schram, Leendert van Maanen, Jelmer Borst.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>